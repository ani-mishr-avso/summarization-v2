<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Executive Summary</title>
  <style>
    :root {
      --bg: #ffffff;
      --surface: #ffffff;
      --surface-alt: #f1f5f9;
      --border: #e2e8f0;
      --text: #0f172a;
      --text-muted: #64748b;
      --heading: #1d4ed8;
      --subheading: #000000;
      --accent: #5b21b6;
      --accent-hover: #6d28d9;
      --string: #15803d;
      --number: #1d4ed8;
      --boolean: #b45309;
      --null: #495057;
      --radius: 6px;
      --font-mono: ui-monospace, "Cascadia Code", "Source Code Pro", Menlo, monospace;
      --font-sans: system-ui, -apple-system, sans-serif;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: var(--font-sans);
      font-size: 14px;
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
    }

    .layout {
      display: flex;
      flex-direction: column;
      max-width: 720px;
      margin: 0 auto;
      padding: 2rem 1.5rem;
      gap: 0;
    }

    .report-title {
      margin: 0 0 1.5rem 0;
      font-size: 0.8125rem;
      font-weight: 500;
      color: var(--text-muted);
      letter-spacing: 0.02em;
      text-transform: uppercase;
    }

    .tree-actions {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .tree-actions .btn-link {
      padding: 0;
      font-size: 12px;
      font-family: inherit;
      border: none;
      background: none;
      color: var(--text-muted);
      cursor: pointer;
      text-decoration: underline;
      text-underline-offset: 2px;
    }

    .tree-actions .btn-link:hover {
      color: var(--text);
    }

    .output {
      flex: 1;
      min-height: 200px;
      overflow: auto;
      padding: 0;
      background: transparent;
      border: none;
    }

    .output:empty::before {
      content: "No content.";
      color: var(--text-muted);
    }

    .error {
      padding: 0.75rem;
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-radius: var(--radius);
      color: #b91c1c;
      font-family: var(--font-mono);
      font-size: 13px;
    }

    .json-doc {
      font-family: var(--font-sans);
      font-size: 15px;
      line-height: 1.6;
    }

    .json-doc .json-doc-section {
      margin-top: 0;
      margin-bottom: 0;
      padding: 1rem 1.25rem;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: var(--surface);
    }

    .json-doc .json-doc-section + .json-doc-section {
      margin-top: 1rem;
    }

    .json-doc .json-doc-section:first-child {
      margin-top: 0;
    }

    .json-doc .json-doc-heading {
      margin: 0 0 0.5em 0;
      font-size: 1em;
      font-weight: 600;
      border-bottom: 1px solid var(--border);
      padding-bottom: 0.35em;
    }

    .json-doc .json-doc-section h2.json-doc-heading {
      font-size: 1.2em;
      color: var(--heading);
    }

    .json-doc .json-doc-section h3.json-doc-heading,
    .json-doc .json-doc-section h4.json-doc-heading,
    .json-doc .json-doc-section h5.json-doc-heading,
    .json-doc .json-doc-section h6.json-doc-heading {
      font-size: 1.05em;
      color: var(--subheading);
    }

    .json-doc .json-doc-section h4.json-doc-heading { font-size: 1em; }
    .json-doc .json-doc-section h5.json-doc-heading,
    .json-doc .json-doc-section h6.json-doc-heading { font-size: 0.95em; }

    .json-doc .json-doc-details {
      margin-left: 0;
    }

    .json-doc .json-doc-details summary {
      cursor: pointer;
      list-style: none;
    }

    .json-doc .json-doc-details summary::-webkit-details-marker {
      display: none;
    }

    .json-doc .json-doc-body {
      margin-top: 0.5rem;
      padding-left: 1rem;
      border-left: 3px solid var(--border);
    }

    .json-doc .json-value {
      margin: 0.25rem 0;
      font-family: var(--font-mono);
      font-size: 13px;
      word-break: break-word;
    }

    .json-doc .json-value.value-string { color: var(--string); }
    .json-doc .json-value.value-number { color: var(--number); }
    .json-doc .json-value.value-boolean { color: var(--boolean); }
    .json-doc .json-value.value-null { color: var(--null); }

    .json-doc .json-doc-list {
      margin: 0.35em 0;
      padding-left: 1.5rem;
    }

    .json-doc .json-doc-list li {
      margin: 0.2em 0;
      font-family: var(--font-mono);
      font-size: 13px;
    }

    .json-doc .json-doc-list li.value-string { color: var(--string); }
    .json-doc .json-doc-list li.value-number { color: var(--number); }
    .json-doc .json-doc-list li.value-boolean { color: var(--boolean); }
    .json-doc .json-doc-list li.value-null { color: var(--null); }
  </style>
</head>
<body>
  <div class="layout">
    <p class="report-title">Executive Summary</p>
    <div class="tree-actions" id="treeActions" style="display: none;">
      <button type="button" class="btn-link" id="expandAllBtn">Expand all</button>
      <button type="button" class="btn-link" id="collapseAllBtn">Collapse all</button>
    </div>
    <div class="output" id="output"></div>
    <div id="errorBox" class="error" style="display: none;"></div>
  </div>

  <script>
    (function () {
      const output = document.getElementById('output');
      const errorBox = document.getElementById('errorBox');
      const treeActions = document.getElementById('treeActions');
      const expandAllBtn = document.getElementById('expandAllBtn');
      const collapseAllBtn = document.getElementById('collapseAllBtn');

      function showError(msg) {
        errorBox.textContent = msg;
        errorBox.style.display = 'block';
        output.innerHTML = '';
      }

      function clearError() {
        errorBox.style.display = 'none';
      }

      function typeOf(value) {
        if (value === null) return 'null';
        if (Array.isArray(value)) return 'array';
        return typeof value;
      }

      function escapeHtml(str) {
        const div = document.createElement('div');
        div.textContent = str;
        return div.innerHTML;
      }

      function toTitleCase(str) {
        return String(str)
          .replace(/([a-z])([A-Z])/g, '$1 $2')
          .replace(/[_-]+/g, ' ')
          .replace(/\b\w/g, function (c) { return c.toUpperCase(); })
          .trim();
      }

      function headingLevel(depth) {
        return Math.min(depth + 2, 6);
      }

      function makeValueBlock(value, t) {
        const p = document.createElement('p');
        p.className = 'json-value value-' + t;
        if (t === 'string') {
          p.textContent = escapeHtml(String(value));
        } else if (t === 'null') {
          p.textContent = 'null';
        } else {
          p.textContent = String(value);
        }
        return p;
      }

      function buildDoc(data, depth) {
        depth = depth || 0;
        const t = typeOf(data);
        const tag = 'h' + headingLevel(depth);

        if (t === 'object') {
          const fragment = document.createDocumentFragment();
          Object.entries(data).forEach(function (entry) {
            const [k, v] = entry;
            const childType = typeOf(v);
            const isArrayOfPrimitives = childType === 'array' && v.every(function (x) {
              const tx = typeOf(x);
              return tx !== 'object' && tx !== 'array';
            });
            const isNested = childType === 'object' || (childType === 'array' && !isArrayOfPrimitives);
            const section = document.createElement('section');
            section.className = 'json-doc-section';

            if (isNested) {
              const details = document.createElement('details');
              details.className = 'json-doc-details';
              details.open = true;
              const summary = document.createElement('summary');
              const heading = document.createElement(tag);
              heading.className = 'json-doc-heading';
              heading.textContent = toTitleCase(k);
              summary.appendChild(heading);
              details.appendChild(summary);
              const body = document.createElement('div');
              body.className = 'json-doc-body';
              body.appendChild(buildDoc(v, depth + 1));
              details.appendChild(body);
              section.appendChild(details);
            } else {
              const heading = document.createElement(tag);
              heading.className = 'json-doc-heading';
              heading.textContent = toTitleCase(k);
              section.appendChild(heading);
              section.appendChild(buildDoc(v, depth + 1));
            }
            fragment.appendChild(section);
          });
          return fragment;
        }

        if (t === 'array') {
          const allPrimitive = data.every(function (v) {
            const x = typeOf(v);
            return x !== 'object' && x !== 'array';
          });
          if (allPrimitive) {
            const ul = document.createElement('ul');
            ul.className = 'json-doc-list';
            data.forEach(function (v) {
              const li = document.createElement('li');
              const tVal = typeOf(v);
              li.className = 'json-value value-' + tVal;
              if (tVal === 'string') li.textContent = escapeHtml(String(v));
              else if (tVal === 'null') li.textContent = 'null';
              else li.textContent = String(v);
              ul.appendChild(li);
            });
            return ul;
          }
          const fragment = document.createDocumentFragment();
          data.forEach(function (item, i) {
            const section = document.createElement('section');
            section.className = 'json-doc-section';
            const itemType = typeOf(item);
            const isNested = itemType === 'object' || itemType === 'array';
            const label = 'Item ' + i;
            if (isNested) {
              const details = document.createElement('details');
              details.className = 'json-doc-details';
              details.open = true;
              const summary = document.createElement('summary');
              const heading = document.createElement(tag);
              heading.className = 'json-doc-heading';
              heading.textContent = toTitleCase(label);
              summary.appendChild(heading);
              details.appendChild(summary);
              const body = document.createElement('div');
              body.className = 'json-doc-body';
              body.appendChild(buildDoc(item, depth + 1));
              details.appendChild(body);
              section.appendChild(details);
            } else {
              const heading = document.createElement(tag);
              heading.className = 'json-doc-heading';
              heading.textContent = toTitleCase(label);
              section.appendChild(heading);
              section.appendChild(buildDoc(item, depth + 1));
            }
            fragment.appendChild(section);
          });
          return fragment;
        }

        return makeValueBlock(data, t);
      }

      function buildDocRoot(data) {
        const t = typeOf(data);
        const wrapper = document.createElement('div');
        wrapper.className = 'json-doc';
        if (t === 'object') {
          wrapper.appendChild(buildDoc(data, 0));
        } else if (t === 'array') {
          wrapper.appendChild(buildDoc(data, 0));
        } else {
          wrapper.appendChild(buildDoc(data, 0));
        }
        return wrapper;
      }

      function render(data) {
        const doc = buildDocRoot(data);
        output.innerHTML = '';
        output.appendChild(doc);
        treeActions.style.display = 'flex';
      }

      expandAllBtn.addEventListener('click', function () {
        output.querySelectorAll('.json-doc details').forEach(function (el) {
          el.open = true;
        });
      });

      collapseAllBtn.addEventListener('click', function () {
        output.querySelectorAll('.json-doc details').forEach(function (el) {
          el.open = false;
        });
      });

      if (typeof INITIAL_JSON !== 'undefined') {
        try {
          const data = JSON.parse(INITIAL_JSON);
          render(data);
        } catch (e) {
          showError('Invalid JSON: ' + e.message);
        }
      }

      window.jsonToHtml = function (json) {
        const data = typeof json === 'string' ? JSON.parse(json) : json;
        const wrapper = buildDocRoot(data);
        return wrapper.outerHTML;
      };
    })();
  </script>
</body>
</html>
